{% extends "base.html" %}

{% block title %}{{ product.name }} - Ecome{% endblock %}

{% block content %}
<div class="row mt-5">
  <!-- Image -->
  <div class="col-md-6">
    <div id="productImagesCarousel" class="carousel slide">
      <div class="carousel-inner">

        {% if product.image %}
        <div class="carousel-item active">
          <img src="{{ product.image.url }}" class="d-block w-100 rounded shadow-sm"
            style="height:400px; object-fit:cover;" alt="{{ product.name }}">
        </div>
        {% endif %}

        {% if product.image1 %}
        <div class="carousel-item">
          <img src="{{ product.image1.url }}" class="d-block w-100 rounded shadow-sm"
            style="height:400px; object-fit:cover;" alt="{{ product.name }} Image 1">
        </div>
        {% endif %}

        {% if product.image2 %}
        <div class="carousel-item">
          <img src="{{ product.image2.url }}" class="d-block w-100 rounded shadow-sm"
            style="height:400px; object-fit:cover;" alt="{{ product.name }} Image 2">
        </div>
        {% endif %}

        {% if product.image3 %}
        <div class="carousel-item">
          <img src="{{ product.image3.url }}" class="d-block w-100 rounded shadow-sm"
            style="height:400px; object-fit:cover;" alt="{{ product.name }} Image 3">
        </div>
        {% endif %}

        {% if product.image4 %}
        <div class="carousel-item">
          <img src="{{ product.image4.url }}" class="d-block w-100 rounded shadow-sm"
            style="height:400px; object-fit:cover;" alt="{{ product.name }} Image 4">
        </div>
        {% endif %}
      </div>

      <!-- Controls -->
      <button class="carousel-control-prev" type="button" data-bs-target="#productImagesCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#productImagesCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
      </button>

      <!-- Thumbnails Indicators -->
      <div class="carousel-indicators mt-3 position-static d-flex flex-wrap justify-content-center">
        {% if product.image %}
        <img src="{{ product.image.url }}" data-bs-target="#productImagesCarousel" data-bs-slide-to="0"
          class="active rounded m-1" style="width:80px; height:80px; object-fit:cover; cursor:pointer;">
        {% endif %}
        {% if product.image1 %}
        <img src="{{ product.image1.url }}" data-bs-target="#productImagesCarousel" data-bs-slide-to="1"
          class="rounded m-1" style="width:80px; height:80px; object-fit:cover; cursor:pointer;">
        {% endif %}
        {% if product.image2 %}
        <img src="{{ product.image2.url }}" data-bs-target="#productImagesCarousel" data-bs-slide-to="2"
          class="rounded m-1" style="width:80px; height:80px; object-fit:cover; cursor:pointer;">
        {% endif %}
        {% if product.image3 %}
        <img src="{{ product.image3.url }}" data-bs-target="#productImagesCarousel" data-bs-slide-to="3"
          class="rounded m-1" style="width:80px; height:80px; object-fit:cover; cursor:pointer;">
        {% endif %}
        {% if product.image4 %}
        <img src="{{ product.image4.url }}" data-bs-target="#productImagesCarousel" data-bs-slide-to="4"
          class="rounded m-1" style="width:80px; height:80px; object-fit:cover; cursor:pointer;">
        {% endif %}
      </div>
    </div>
  </div>




  <!-- Details -->
  <div class="col-md-6 d-flex flex-column p-4"
    style="background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%); border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
    <h2 class="fw-bold mb-3" style="font-size: 2rem; color: #1a1a1a;">{{ product.name }}</h2>
    <p class="text-muted mb-2" style="font-size: 1.1rem;"><strong>Brand:</strong> {{ product.brand }}</p>
    <hr style="border-color: rgba(0, 0, 0, 0.1);">
    <h3 class="text-success mb-3" style="font-size: 1.8rem; font-weight: 700;">$ {{ product.price }}</h3>
    <p class="mb-2" style="font-size: 1rem;"><strong>Discount:</strong> <span
        class="badge bg-danger rounded-pill px-3 py-2">{{ product.discount }}%</span></p>
    <p class="mb-3" style="font-size: 1rem;"><strong>Stock:</strong>
      {% if product.stock > 0 %}
      <span class="text-success fw-bold">In Stock ({{ product.stock }})</span>
      {% else %}
      <span class="text-danger fw-bold">Out of Stock</span>
      {% endif %}
    </p>
    <p class="mb-4" style="font-size: 1rem; line-height: 1.6;">
      <strong>Description:</strong><br>
      {{ product.description|default:"No description available." }}
    </p>


    <div class="mt-auto d-flex gap-3">
      <a href="#" class="btn btn-warning text-dark fw-bold rounded-pill flex-grow-1"
        style="background: linear-gradient(90deg, #FCFF6C 0%, #FFD700 100%); border: none; padding: 12px 0; transition: background 0.3s ease, transform 0.2s ease;">
        Add to Cart
      </a>
      <a href="#" class="btn btn-danger fw-bold rounded-pill flex-grow-1"
        style="background: linear-gradient(90deg, #dc3545 0%, #c82333 100%); border: none; padding: 12px 0; transition: background 0.3s ease, transform 0.2s ease;">
        Buy Now
      </a>

      <!-- Like -->
      {% if user.is_authenticated %}
      {% if liked %}
      <!-- Already liked -->
      <a href="{% url 'unlike_product' product.id %}" class="btn btn-danger fw-bold rounded-pill">
        Unlike
      </a>
      {% else %}
      <!-- Not liked yet -->
      <form action="{% url 'add_like' product.id %}" method="post">
        {% csrf_token %}
        <button type="submit" class="btn btn-success fw-bold rounded-pill">
          Like
        </button>
      </form>
      {% endif %}
      {% endif %}


    </div>
  </div>
</div>


<div class="container my-5">
  <div class="row">
    <!-- Left: Reviews Section -->
    <div class="col-md-6">
      <h3 class="mb-4 fw-bold text-center">Customer Reviews</h3>


      <!-- Add Review Button -->
      <div class="mt-3 text-center">
        <a href="{% url 'add_review' product.id %}" class="btn btn-primary">
          Add Review
        </a>
      </div>
      <br>

      {% for review in reviews %}
      <div class="card mb-3 shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title mb-1 fw-semibold">{{ review.user.username }}</h5>
          <p class="card-text text-muted">{{ review.comment }}</p>
          <small class="text-warning">
            {% for i in "12345"|make_list %}
            {% if forloop.counter <= review.rating %}â˜…{% else %}â˜†{% endif %} {% endfor %} </small>
        </div>
      </div>
      {% empty %}
      <p class="text-center text-muted">No reviews yet.</p>
      {% endfor %}


    </div>

    <!-- Right: Bidding Section -->
    <div class="col-md-6">
      <h3 class="mb-4 fw-bold text-center">Product Bids</h3>

      <!-- Place Bid Button -->
      {% if user.is_authenticated and product.is_bidding_open %}
      <div class="mt-3 text-center">
        <a href="{% url 'add_bid' product.id %}" class="btn btn-success">Place Your Bid</a>
      </div>
      {% endif %}

      {% if request.user == product.user and product.is_bidding_open %}
      <div class="mt-3 text-center">
        <a href="{% url 'close_bid' product.id %}" class="btn btn-danger">
          Close Bid
        </a>
      </div>
      {% endif %}


      <div>
        {% if not product.is_bidding_open %}
        <p>Biddings are closed on this product</p>
        {% endif %}
      </div>
      <h3>Biddings</h3>


      <!-- Show All Bids -->
      <div class="mt-4">
        {% for bid in bids %}
        <div class="card mb-2 shadow-sm border-0">
          <div class="card-body d-flex justify-content-between align-items-center">
            <div>
              {% if bid.user == user %}
              <a href="{% url 'edit_bid' bid.id %}" class="card-text text-muted btn btn-primary">Edit Bid</a>
              {% endif %}
              <span class="fw-semibold">{{ bid.user.username }}</span> <!-- ðŸ‘ˆ User ka naam -->
              <small class="text-muted">bid on {{ bid.product.name }}</small>
            </div>
            <span class="text-success fw-bold">${{ bid.amount }}</span>
          </div>
        </div>
        {% empty %}
        <p class="text-center text-muted mt-3">No bidding yet.</p>
        {% endfor %}
      </div>
    </div>

  </div>
</div>






<!-- {% if user.is_authenticated %}
<div class="mt-4">
  <a href="{% url 'add_review' product.id %}" 
     class="btn-review">
    Add Review
  </a>
 {% else %}
    <p class="text-muted mt-3">
      <a href="{% url 'login' %}">Login</a> to add a review.
    </p>
  {% endif %}
</div> -->

{% endblock %}